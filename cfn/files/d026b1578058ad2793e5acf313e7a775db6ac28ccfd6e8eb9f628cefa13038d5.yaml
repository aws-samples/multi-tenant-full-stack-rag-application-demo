Conditions:
  CDKMetadataAvailable:
    Fn::Or:
    - Fn::Or:
      - Fn::Equals:
        - Ref: AWS::Region
        - af-south-1
      - Fn::Equals:
        - Ref: AWS::Region
        - ap-east-1
      - Fn::Equals:
        - Ref: AWS::Region
        - ap-northeast-1
      - Fn::Equals:
        - Ref: AWS::Region
        - ap-northeast-2
      - Fn::Equals:
        - Ref: AWS::Region
        - ap-south-1
      - Fn::Equals:
        - Ref: AWS::Region
        - ap-southeast-1
      - Fn::Equals:
        - Ref: AWS::Region
        - ap-southeast-2
      - Fn::Equals:
        - Ref: AWS::Region
        - ca-central-1
      - Fn::Equals:
        - Ref: AWS::Region
        - cn-north-1
      - Fn::Equals:
        - Ref: AWS::Region
        - cn-northwest-1
    - Fn::Or:
      - Fn::Equals:
        - Ref: AWS::Region
        - eu-central-1
      - Fn::Equals:
        - Ref: AWS::Region
        - eu-north-1
      - Fn::Equals:
        - Ref: AWS::Region
        - eu-south-1
      - Fn::Equals:
        - Ref: AWS::Region
        - eu-west-1
      - Fn::Equals:
        - Ref: AWS::Region
        - eu-west-2
      - Fn::Equals:
        - Ref: AWS::Region
        - eu-west-3
      - Fn::Equals:
        - Ref: AWS::Region
        - il-central-1
      - Fn::Equals:
        - Ref: AWS::Region
        - me-central-1
      - Fn::Equals:
        - Ref: AWS::Region
        - me-south-1
      - Fn::Equals:
        - Ref: AWS::Region
        - sa-east-1
    - Fn::Or:
      - Fn::Equals:
        - Ref: AWS::Region
        - us-east-1
      - Fn::Equals:
        - Ref: AWS::Region
        - us-east-2
      - Fn::Equals:
        - Ref: AWS::Region
        - us-west-1
      - Fn::Equals:
        - Ref: AWS::Region
        - us-west-2
Outputs:
  mtfsradbdevAuthProviderStackCognitoStackCognitoAuthProviderFunction314FA51DArn:
    Value:
      Fn::GetAtt:
      - CognitoAuthProviderFunction0A1077DD
      - Arn
  mtfsradbdevAuthProviderStackCognitoStackCognitoAuthProviderFunction314FA51DRef:
    Value:
      Ref: CognitoAuthProviderFunction0A1077DD
  mtfsradbdevAuthProviderStackCognitoStackCognitoIdentityPoolAuthenticatedRole7703D556Arn:
    Value:
      Fn::GetAtt:
      - CognitoIdentityPoolAuthenticatedRole15569E4E
      - Arn
  mtfsradbdevAuthProviderStackCognitoStackCognitoIdentityPoolD10B5D4ERef:
    Value:
      Ref: CognitoIdentityPool93F7BD0F
  mtfsradbdevAuthProviderStackCognitoStackUserPool42FCA09FRef:
    Value:
      Ref: UserPool6BA7E5F2
  mtfsradbdevAuthProviderStackCognitoStackUserPoolClient46E47A4DRef:
    Value:
      Ref: UserPoolClient2F5918F7
  mtfsradbdevAuthProviderStackCognitoStackUserPoolDomain51B8FBE5Ref:
    Value:
      Ref: UserPoolDomain5479B217
Resources:
  AuthProviderFunctionNameParam5A18F756:
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderFunctionNameParam/Resource
    Properties:
      Name: /mtfsrad-b-dev/auth_provider_function_name
      Type: String
      Value:
        Ref: CognitoAuthProviderFunction0A1077DD
    Type: AWS::SSM::Parameter
    UpdateReplacePolicy: Delete
  AuthProviderHttpApiC9C2D9A3:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/Resource
    Properties:
      Name: auth
      ProtocolType: HTTP
    Type: AWS::ApiGatewayV2::Api
  AuthProviderHttpApiDefaultStage85F86EDE:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/DefaultStage/Resource
    Properties:
      ApiId:
        Ref: AuthProviderHttpApiC9C2D9A3
      AutoDeploy: true
      StageName: $default
    Type: AWS::ApiGatewayV2::Stage
  AuthProviderHttpApiOPTIONSproxy4B0AB705:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/OPTIONS--{proxy+}/Resource
    Properties:
      ApiId:
        Ref: AuthProviderHttpApiC9C2D9A3
      AuthorizationType: NONE
      RouteKey: OPTIONS /{proxy+}
      Target:
        Fn::Join:
        - ''
        - - integrations/
          - Ref: AuthProviderHttpApiPOSTauthoperationAuthProviderLambdaIntegration64A4DA6E
    Type: AWS::ApiGatewayV2::Route
  AuthProviderHttpApiOPTIONSproxyAuthProviderLambdaIntegrationPermission61F0A9BF:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/OPTIONS--{proxy+}/AuthProviderLambdaIntegration-Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - CognitoAuthProviderFunction0A1077DD
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:'
          - Ref: AWS::Partition
          - ':execute-api:'
          - Ref: AWS::Region
          - ':'
          - Ref: AWS::AccountId
          - ':'
          - Ref: AuthProviderHttpApiC9C2D9A3
          - /*/*/{proxy+}
    Type: AWS::Lambda::Permission
  AuthProviderHttpApiPOSTauthoperation52269BF3:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/POST--auth--{operation}/Resource
    Properties:
      ApiId:
        Ref: AuthProviderHttpApiC9C2D9A3
      AuthorizationType: AWS_IAM
      RouteKey: POST /auth/{operation}
      Target:
        Fn::Join:
        - ''
        - - integrations/
          - Ref: AuthProviderHttpApiPOSTauthoperationAuthProviderLambdaIntegration64A4DA6E
    Type: AWS::ApiGatewayV2::Route
  AuthProviderHttpApiPOSTauthoperationAuthProviderLambdaIntegration64A4DA6E:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/POST--auth--{operation}/AuthProviderLambdaIntegration/Resource
    Properties:
      ApiId:
        Ref: AuthProviderHttpApiC9C2D9A3
      IntegrationType: AWS_PROXY
      IntegrationUri:
        Fn::GetAtt:
        - CognitoAuthProviderFunction0A1077DD
        - Arn
      PayloadFormatVersion: '2.0'
    Type: AWS::ApiGatewayV2::Integration
  AuthProviderHttpApiPOSTauthoperationAuthProviderLambdaIntegrationPermissionEF7F9F05:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/AuthProviderHttpApi/POST--auth--{operation}/AuthProviderLambdaIntegration-Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - CognitoAuthProviderFunction0A1077DD
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:'
          - Ref: AWS::Partition
          - ':execute-api:'
          - Ref: AWS::Region
          - ':'
          - Ref: AWS::AccountId
          - ':'
          - Ref: AuthProviderHttpApiC9C2D9A3
          - /*/*/auth/{operation}
    Type: AWS::Lambda::Permission
  CDKMetadata:
    Condition: CDKMetadataAvailable
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CDKMetadata/Default
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/31Ry07DMBD8lt4d9yUO3ChFiF5QSMW52iZLujSxg72hiqz8O7bTQODAaWd2RivPeCWXNyvpFjO42CQvzklFR+me0TIWe4b8LLxwcBXUxwKke2xVzqSV2L6pKU7R1GStZ70gqKXLdIVBiDPVFeVd9EXUC7s+gLXIVm7C8Fzet/kZ+R4sCvthpXtpsY0nIuhFrktFrKV7tWhSraugfeMRbCtCxVPpuhnpg66B1NTws9kV3kncjdenPATZsG/kVPulT2B9yj0bUmUKBmpkNDHhSHoBDZXAeIHu01f8xNxsGgqeMAL1BZcx4gDCKtMtD2inGEsDY8N/aPT1vcjQ6tbkKGKP4Y5/UDSMgsdbrQri+DmLBKrmBHIxu7v++DzOodyErokbn/jqdL9a+aeSXqQdn7Sar+VyKW9n75YoMa231yizYX4Bv+n1UW8CAAA=
    Type: AWS::CDK::Metadata
  CognitoAuthProviderFunction0A1077DD:
    DependsOn:
    - CognitoAuthProviderFunctionServiceRoleDefaultPolicy5233F193
    - CognitoAuthProviderFunctionServiceRole235C3833
    Metadata:
      aws:asset:is-bundled: true
      aws:asset:path: asset.59b0d2490b95a399164a1c214d826f1246a2780eeb4192a9f2ae094786bb39e6
      aws:asset:property: Code
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoAuthProviderFunction/Resource
    Properties:
      Architectures:
      - x86_64
      Code:
        S3Bucket:
          Fn::Sub: cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}
        S3Key: 59b0d2490b95a399164a1c214d826f1246a2780eeb4192a9f2ae094786bb39e6.zip
      DeadLetterConfig:
        TargetArn:
          Fn::GetAtt:
          - CognitoAuthProviderFunctionDeadLetterQueue041CA74C
          - Arn
      Environment:
        Variables:
          AWS_ACCOUNT_ID:
            Ref: AWS::AccountId
          IDENTITY_POOL_ID:
            Ref: CognitoIdentityPool93F7BD0F
          STACK_NAME: mtfsrad-b-dev
          USER_POOL_ID:
            Ref: UserPool6BA7E5F2
      Handler: multi_tenant_full_stack_rag_application.auth_provider.cognito_auth_provider.handler
      MemorySize: 128
      Role:
        Fn::GetAtt:
        - CognitoAuthProviderFunctionServiceRole235C3833
        - Arn
      Runtime: python3.11
      Timeout: 60
      VpcConfig:
        SecurityGroupIds:
        - Fn::ImportValue: mtfsradbdevVpc39114410:ExportsOutputFnGetAttAppSecurityGroupC396D536GroupId4ECD26A6
        SubnetIds:
        - Fn::ImportValue: mtfsradbdevVpc39114410:ExportsOutputRefVpcprivatewithegressSubnet1Subnet6268702BC3D928D6
        - Fn::ImportValue: mtfsradbdevVpc39114410:ExportsOutputRefVpcprivatewithegressSubnet2Subnet3088D8AE74813843
    Type: AWS::Lambda::Function
  CognitoAuthProviderFunctionDeadLetterQueue041CA74C:
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoAuthProviderFunction/DeadLetterQueue/Resource
    Properties:
      MessageRetentionPeriod: 1209600
    Type: AWS::SQS::Queue
    UpdateReplacePolicy: Delete
  CognitoAuthProviderFunctionServiceRole235C3833:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoAuthProviderFunction/ServiceRole/Resource
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
        Version: '2012-10-17'
      ManagedPolicyArns:
      - Fn::Join:
        - ''
        - - 'arn:'
          - Ref: AWS::Partition
          - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      - Fn::Join:
        - ''
        - - 'arn:'
          - Ref: AWS::Partition
          - :iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
    Type: AWS::IAM::Role
  CognitoAuthProviderFunctionServiceRoleDefaultPolicy5233F193:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoAuthProviderFunction/ServiceRole/DefaultPolicy/Resource
    Properties:
      PolicyDocument:
        Statement:
        - Action: sqs:SendMessage
          Effect: Allow
          Resource:
            Fn::GetAtt:
            - CognitoAuthProviderFunctionDeadLetterQueue041CA74C
            - Arn
        - Action:
          - ssm:GetParameter
          - ssm:GetParametersByPath
          Effect: Allow
          Resource:
            Fn::Join:
            - ''
            - - 'arn:aws:ssm:'
              - Ref: AWS::Region
              - ':'
              - Ref: AWS::AccountId
              - :parameter/mtfsrad-b-dev*
        Version: '2012-10-17'
      PolicyName: CognitoAuthProviderFunctionServiceRoleDefaultPolicy5233F193
      Roles:
      - Ref: CognitoAuthProviderFunctionServiceRole235C3833
    Type: AWS::IAM::Policy
  CognitoIdentityPool93F7BD0F:
    DependsOn:
    - UserPoolPreSignUpCognito3AFF8F1F
    - UserPool6BA7E5F2
    - UserPoolClient2F5918F7
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoIdentityPool/Resource
    Properties:
      AllowUnauthenticatedIdentities: false
      CognitoIdentityProviders:
      - ClientId:
          Ref: UserPoolClient2F5918F7
        ProviderName:
          Fn::Join:
          - ''
          - - cognito-idp.
            - Ref: AWS::Region
            - .
            - Ref: AWS::URLSuffix
            - /
            - Ref: UserPool6BA7E5F2
        ServerSideTokenCheck: true
    Type: AWS::Cognito::IdentityPool
  CognitoIdentityPoolAuthenticatedRole15569E4E:
    DependsOn:
    - UserPoolPreSignUpCognito3AFF8F1F
    - UserPool6BA7E5F2
    - UserPoolClient2F5918F7
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoIdentityPool/AuthenticatedRole/Resource
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRoleWithWebIdentity
          Condition:
            ForAnyValue:StringLike:
              cognito-identity.amazonaws.com:amr: authenticated
            StringEquals:
              cognito-identity.amazonaws.com:aud:
                Ref: CognitoIdentityPool93F7BD0F
          Effect: Allow
          Principal:
            Federated: cognito-identity.amazonaws.com
        Version: '2012-10-17'
      Description:
        Fn::Join:
        - ''
        - - 'Default Authenticated Role for Identity Pool '
          - Fn::GetAtt:
            - CognitoIdentityPool93F7BD0F
            - Name
    Type: AWS::IAM::Role
  CognitoIdentityPoolAuthenticatedRoleDefaultPolicy5CD10838:
    DependsOn:
    - UserPoolPreSignUpCognito3AFF8F1F
    - UserPool6BA7E5F2
    - UserPoolClient2F5918F7
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoIdentityPool/AuthenticatedRole/DefaultPolicy/Resource
    Properties:
      PolicyDocument:
        Statement:
        - Action: execute-api:*
          Effect: Allow
          Resource: '*'
        - Action: lambda:InvokeFunction
          Effect: Allow
          Resource:
          - Fn::GetAtt:
            - CognitoAuthProviderFunction0A1077DD
            - Arn
          - Fn::Join:
            - ''
            - - Fn::GetAtt:
                - CognitoAuthProviderFunction0A1077DD
                - Arn
              - :*
        Version: '2012-10-17'
      PolicyName: CognitoIdentityPoolAuthenticatedRoleDefaultPolicy5CD10838
      Roles:
      - Ref: CognitoIdentityPoolAuthenticatedRole15569E4E
    Type: AWS::IAM::Policy
  CognitoIdentityPoolDefaultRoleAttachment7C1F90CF:
    DependsOn:
    - UserPoolPreSignUpCognito3AFF8F1F
    - UserPool6BA7E5F2
    - UserPoolClient2F5918F7
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoIdentityPool/DefaultRoleAttachment/Resource
    Properties:
      IdentityPoolId:
        Ref: CognitoIdentityPool93F7BD0F
      Roles:
        authenticated:
          Fn::GetAtt:
          - CognitoIdentityPoolAuthenticatedRole15569E4E
          - Arn
        unauthenticated:
          Fn::GetAtt:
          - CognitoIdentityPoolUnauthenticatedRole2280399E
          - Arn
    Type: AWS::Cognito::IdentityPoolRoleAttachment
  CognitoIdentityPoolIdFD9654E6:
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoIdentityPoolId/Resource
    Properties:
      Name: /mtfsrad-b-dev/identity_pool_id
      Type: String
      Value:
        Ref: CognitoIdentityPool93F7BD0F
    Type: AWS::SSM::Parameter
    UpdateReplacePolicy: Delete
  CognitoIdentityPoolUnauthenticatedRole2280399E:
    DependsOn:
    - UserPoolPreSignUpCognito3AFF8F1F
    - UserPool6BA7E5F2
    - UserPoolClient2F5918F7
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoIdentityPool/UnauthenticatedRole/Resource
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRoleWithWebIdentity
          Condition:
            ForAnyValue:StringLike:
              cognito-identity.amazonaws.com:amr: unauthenticated
            StringEquals:
              cognito-identity.amazonaws.com:aud:
                Ref: CognitoIdentityPool93F7BD0F
          Effect: Allow
          Principal:
            Federated: cognito-identity.amazonaws.com
        Version: '2012-10-17'
      Description:
        Fn::Join:
        - ''
        - - 'Default Unauthenticated Role for Identity Pool '
          - Fn::GetAtt:
            - CognitoIdentityPool93F7BD0F
            - Name
    Type: AWS::IAM::Role
  CognitoOpenSearchDashboardRoleD9C6807C:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoOpenSearchDashboardRole/Resource
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRoleWithWebIdentity
          Condition:
            ForAnyValue:StringLike:
              cognito-identity.amazonaws.com:amr: authenticated
            StringEquals:
              cognito-identity.amazonaws.com:aud:
                Ref: CognitoIdentityPool93F7BD0F
          Effect: Allow
          Principal:
            Federated: cognito-identity.amazonaws.com
        Version: '2012-10-17'
      Description: Default role for OpenSearch Dashboard users
    Type: AWS::IAM::Role
  CognitoOpenSearchDashboardRoleDefaultPolicy3F92057A:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoOpenSearchDashboardRole/DefaultPolicy/Resource
    Properties:
      PolicyDocument:
        Statement:
        - Action:
          - cognito-identity:GetCredentialsForIdentity
          - es:*
          Effect: Allow
          Resource: '*'
        Version: '2012-10-17'
      PolicyName: CognitoOpenSearchDashboardRoleDefaultPolicy3F92057A
      Roles:
      - Ref: CognitoOpenSearchDashboardRoleD9C6807C
    Type: AWS::IAM::Policy
  CognitoUserPoolIdE8BC6937:
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/CognitoUserPoolId/Resource
    Properties:
      Name: /mtfsrad-b-dev/user_pool_id
      Type: String
      Value:
        Ref: UserPool6BA7E5F2
    Type: AWS::SSM::Parameter
    UpdateReplacePolicy: Delete
  PreSignupTrigger32516C18:
    DependsOn:
    - PreSignupTriggerServiceRoleDefaultPolicy146455E5
    - PreSignupTriggerServiceRole206D29A9
    Metadata:
      aws:asset:is-bundled: true
      aws:asset:path: asset.04ee80537e298c343d63e214f1644f10f65e0e8943698b8b43b367f4935ad425
      aws:asset:property: Code
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/PreSignupTrigger/Resource
    Properties:
      Architectures:
      - x86_64
      Code:
        S3Bucket:
          Fn::Sub: cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}
        S3Key: 04ee80537e298c343d63e214f1644f10f65e0e8943698b8b43b367f4935ad425.zip
      DeadLetterConfig:
        TargetArn:
          Fn::GetAtt:
          - PreSignupTriggerDeadLetterQueue054D8503
          - Arn
      Environment:
        Variables:
          ALLOWED_EMAIL_DOMAINS: amazon.com
          STACK_NAME: mtfsrad-b-dev
      Handler: multi_tenant_full_stack_rag_application.auth_provider.cognito_pre_signup_trigger.handler
      MemorySize: 128
      Role:
        Fn::GetAtt:
        - PreSignupTriggerServiceRole206D29A9
        - Arn
      Runtime: python3.11
      Timeout: 60
    Type: AWS::Lambda::Function
  PreSignupTriggerDeadLetterQueue054D8503:
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/PreSignupTrigger/DeadLetterQueue/Resource
    Properties:
      MessageRetentionPeriod: 1209600
    Type: AWS::SQS::Queue
    UpdateReplacePolicy: Delete
  PreSignupTriggerServiceRole206D29A9:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/PreSignupTrigger/ServiceRole/Resource
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
        Version: '2012-10-17'
      ManagedPolicyArns:
      - Fn::Join:
        - ''
        - - 'arn:'
          - Ref: AWS::Partition
          - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Type: AWS::IAM::Role
  PreSignupTriggerServiceRoleDefaultPolicy146455E5:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/PreSignupTrigger/ServiceRole/DefaultPolicy/Resource
    Properties:
      PolicyDocument:
        Statement:
        - Action: sqs:SendMessage
          Effect: Allow
          Resource:
            Fn::GetAtt:
            - PreSignupTriggerDeadLetterQueue054D8503
            - Arn
        Version: '2012-10-17'
      PolicyName: PreSignupTriggerServiceRoleDefaultPolicy146455E5
      Roles:
      - Ref: PreSignupTriggerServiceRole206D29A9
    Type: AWS::IAM::Policy
  UserPool6BA7E5F2:
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/UserPool/Resource
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
        - Name: verified_phone_number
          Priority: 1
        - Name: verified_email
          Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: false
      AutoVerifiedAttributes:
      - email
      EmailVerificationMessage: Thanks for signing up for the multi-tenant, full-stack
        RAG application demo! Your verification code is {{####}}
      EmailVerificationSubject: Verify your email for Multi-tenant full-stack RAG
        application demo
      LambdaConfig:
        PreSignUp:
          Fn::GetAtt:
          - PreSignupTrigger32516C18
          - Arn
      Policies:
        PasswordPolicy:
          MinimumLength: 8
          RequireLowercase: true
          RequireNumbers: true
          RequireSymbols: true
          RequireUppercase: true
      SmsVerificationMessage: Thanks for signing up for the multi-tenant, full-stack
        RAG application demo! Your verification code is {{####}}
      UserPoolName: mtfsrad-b-devUserPool
      UsernameAttributes:
      - email
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: Thanks for signing up for the multi-tenant, full-stack RAG application
          demo! Your verification code is {{####}}
        EmailSubject: Verify your email for Multi-tenant full-stack RAG application
          demo
        SmsMessage: Thanks for signing up for the multi-tenant, full-stack RAG application
          demo! Your verification code is {{####}}
    Type: AWS::Cognito::UserPool
    UpdateReplacePolicy: Delete
  UserPoolClient2F5918F7:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/UserPoolClient/Resource
    Properties:
      AllowedOAuthFlows:
      - implicit
      - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
      - profile
      - phone
      - email
      - openid
      - aws.cognito.signin.user.admin
      CallbackURLs:
      - https://example.com
      SupportedIdentityProviders:
      - COGNITO
      UserPoolId:
        Ref: UserPool6BA7E5F2
    Type: AWS::Cognito::UserPoolClient
  UserPoolDomain5479B217:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/UserPoolDomain/Resource
    Properties:
      Domain:
        Fn::Join:
        - ''
        - - mtfsrad-b-dev-
          - Ref: AWS::AccountId
          - '-'
          - Ref: AWS::Region
      UserPoolId:
        Ref: UserPool6BA7E5F2
    Type: AWS::Cognito::UserPoolDomain
  UserPoolPreSignUpCognito3AFF8F1F:
    Metadata:
      aws:cdk:path: mtfsrad-b-dev/AuthProviderStack/CognitoStack/UserPool/PreSignUpCognito
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - PreSignupTrigger32516C18
        - Arn
      Principal: cognito-idp.amazonaws.com
      SourceArn:
        Fn::GetAtt:
        - UserPool6BA7E5F2
        - Arn
    Type: AWS::Lambda::Permission
