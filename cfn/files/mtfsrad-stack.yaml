AWSTemplateFormatVersion: '2010-09-09'
Description: Root stack for mtfsrad
Parameters:
  allowedEmailDomains:
    Description: Set the allowed email domains that are allowed to create accounts.
    Type: String
  appName:
    Default: Multi-tenant, full-stack RAG application demo
    Description: Set the app name
    Type: String
  removalPolicy:
    Default: DESTROY
    Description: Set removal policy for stacks
    Type: String
  signUpEmailBody:
    Default: Your verification code is {####}
    Description: Set the email body for sign up verification
    Type: String
  signUpEmailSubject:
    Default: Verification code for multi-tenant, full-stack RAG application demo
    Description: Set the email subject for sign up verification
    Type: String
Resources:
  VpcStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/vpc-stack-template.yaml
  AuthStack:
    Type: AWS::CloudFormation::Stack 
    Properties:
      Parameters:
        allowedEmailDomains: !Ref allowedEmailDomains
        appName: !Ref appName 
        removalPolicy: !Ref removalPolicy
        signUpEmailBody: !Ref signUpEmailBody
        signUpEmailSubject: !Ref signUpEmailSubject
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/auth-stack-template.yaml
  BedrockStack:  
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/bedrock-stack-template.yaml
  DocCollectionsStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/doc-collections-stack-template.yaml
  EmbeddingsStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/embeddings-stack-template.yaml
  EnrichmentPipelinesStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/enrichment-pipelines-stack-template.yaml
  GenerationHandlerStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/generation-handler-stack-template.yaml
  GraphStoreStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/graph-store-stack-template.yaml
  IngestionStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/ingestion-stack-template.yaml
  PromptTemplatesStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/prompt-templates-stack-template.yaml
  UIStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/ui-stack-template.yaml
  VectorStoreStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/vector-store-stack-template.yaml
  FinalStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # Parameters:
      #   EnvironmentName: dev
      TemplateURL: https://davetbo-genai-demos.s3.us-west-2.amazonaws.com/mtfsrad-templates/mtfsrad-final-stack-template.yaml
